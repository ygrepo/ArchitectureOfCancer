---
title: "Gene, Cancers Associations - Beta MAVE scores Associations"
author: "Yves Greatti"
date: "2023-10-30"
output:
  html_document:
    css: style.css
    theme: united
    code_folding: hide
    highlight: tango
    df_print: tibble
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, include=FALSE}
rm(list = ls())
library(tidyverse)
library(ggcorrplot)
library(plotly)
library(kableExtra)


ouput_path <- "ouputs"
figure_path <- "figures"

source("plot_lib.R", local = knitr::knit_global())
source("util_lib.R", local = knitr::knit_global())
```

# Loading Mave Information ...

```{r echo=FALSE, message=FALSE, warning=FALSE}
mave_data <- readMaveData("../data/mave_data_brn_v3.csv")
cancer_filenames <- getCancerFiles("../data/t0.01", gene_target)
```


## BRCA1 burden for Lung Cancer

We are focusing on the BRCA1 gene burden and its association with a few cancer phenotypes.

```{r echo=FALSE, message=FALSE, warning=FALSE}
gene_target <- "BRCA1"

data <- as_tibble(read.table(cancer_filenames[["BreastCancer"]],
  header = TRUE, sep = ","
))

data <- data %>%
  mutate(ProteinChange = str_extract(hgvsp, "(?<=:).+"))

common_proteins <- intersect(unique(data$ProteinChange), unique(mave_data$ProteinChange))
data_mave_df <- data %>%
  inner_join(mave_data  %>% filter(gene == gene_target), by = "ProteinChange") 

# Compute correlation and p-value
p_val <- get_beta_FUSE_correlation_p_value(data_mave_df)

title_txt <- bquote(paste("Breast cancer, ", beta, " vs. FUSE Score, p=", 
                              .(round(p_val, 4))))
xlabel <- "FUSE Score"
ylabel <- "Beta"
x_col <- "FUSE_score"
y_col <- "beta"
xlimits <- c(-3, 3)
xbreaks <- seq(-3, 3, by = 1)
ylimits <- c(-3, 6)
ybreaks <- seq(-2, 6, by = 1)

pt <- get_scatter_plot(data_mave_df,
  title_txt,
  xlabel,
  ylabel,
  x_col = x_col,
  y_col = y_col,
  alpha = 2,
  point_size = 2,
  point_color = "#00AFBB",
  font_size = 14,
  annotate_text_size = 2,
  xlimits = xlimits,
  xbreaks = xbreaks,
  ylimits = ylimits,
  ybreaks = ybreaks
)
pt
# 
# ggplotly(pt) %>%
#     layout(title = list(text = paste0(title_txt))) 

```

Total proteins In common:  `r length(common_proteins)`.


## BRCA1 burden for Colorectal Cancer

```{r echo=FALSE, message=FALSE, warning=FALSE}
data <- as_tibble(read.table("../data/BRCA1_ColorectalCancer.csv_2023_10_06_10_16_00.csv",
  header = TRUE, sep = ","
))

data <- data %>%
  mutate(Protein = str_extract(hgvsp, "(?<=:).+"))


common_proteins <- intersect(unique(data$Protein), unique(mave_data$Protein))
data_mave_df <- data %>% inner_join(mave_data, by = "Protein")

title_txt <- "Mave FUSE Score vs. Beta"
xlabel <- "FUSE Score"
ylabel <- "Beta"
x_col <- "FUSE_score"
y_col <- "beta"
xlimits <- c(-3, 4.5)
xbreaks <- seq(-3, 4.5, by = 1)
ylimits <- c(-1.5, 6)
ybreaks <- seq(-1.5, 6, by = 1)
pt <- get_scatter_plot(data_mave_df,
  title_txt,
  xlabel,
  ylabel,
  x_corr = 3,
  y_corr = 2.5,
  alpha = 2,
  point_size = 2,
  point_color = "#00AFBB",
  font_size = 14,
  annotate_text_size = 4,
  xlimits = xlimits,
  xbreaks = xbreaks,
  ylimits = ylimits,
  ybreaks = ybreaks
)
ggplotly(pt)
```

Total proteins In common:  `r length(common_proteins)`.

## BRCA1 burden for Prostate Cancer

```{r echo=FALSE, message=FALSE, warning=FALSE}
data <- as_tibble(read.table("../data/BRCA1_ProstateCancerCustom.csv_2023_10_06_10_12_33.csv",
  header = TRUE, sep = ","
))

data <- data %>%
  mutate(Protein = str_extract(hgvsp, "(?<=:).+"))


common_proteins <- intersect(unique(data$Protein), unique(mave_data$Protein))
data_mave_df <- data %>% inner_join(mave_data, by = "Protein")

title_txt <- "Mave FUSE Score vs. Beta"
xlabel <- "FUSE Score"
ylabel <- "Beta"
x_col <- "FUSE_score"
y_col <- "beta"
xlimits <- c(-3, 4.5)
xbreaks <- seq(-3, 4.5, by = 1)
ylimits <- c(-1.5, 6)
ybreaks <- seq(-1.5, 6, by = 1)
pt <- get_scatter_plot(data_mave_df,
  title_txt,
  xlabel,
  ylabel,
  x_corr = 3,
  y_corr = 2.5,
  alpha = 2,
  raw_score,
  beta,
  point_size = 2,
  point_color = "#00AFBB",
  font_size = 14,
  annotate_text_size = 4,
  xlimits = xlimits,
  xbreaks = xbreaks,
  ylimits = ylimits,
  ybreaks = ybreaks
)
ggplotly(pt)
```


Total proteins In common:  `r length(common_proteins)`.

## BRCA1 burden for Bladder Cancer

```{r echo=FALSE, message=FALSE, warning=FALSE}
data <- as_tibble(read.table("../data/BRCA1_C67 Malignant neoplasm of Bladder.csv_2023_10_06_10_08_47.csv",
  header = TRUE, sep = ","
))

data <- data %>%
  mutate(Protein = str_extract(hgvsp, "(?<=:).+"))


common_proteins <- intersect(unique(data$Protein), unique(mave_data$Protein))
data_mave_df <- data %>% inner_join(mave_data, by = "Protein")

title_txt <- "Mave FUSE Score vs. Beta"
xlabel <- "FUSE Score"
ylabel <- "Beta"
x_col <- "FUSE_score"
y_col <- "beta"
xlimits <- c(-3, 4.5)
xbreaks <- seq(-3, 4.5, by = 1)
ylimits <- c(-1.5, 6)
ybreaks <- seq(-1.5, 6, by = 1)
pt <- get_scatter_plot(data_mave_df,
  title_txt,
  xlabel,
  ylabel,
  x_corr = 3,
  y_corr = 2.5,
  alpha = 2,
  raw_score,
  beta,
  point_size = 2,
  point_color = "#00AFBB",
  font_size = 14,
  annotate_text_size = 4,
  xlimits = xlimits,
  xbreaks = xbreaks,
  ylimits = ylimits,
  ybreaks = ybreaks
)
ggplotly(pt)
```


Total proteins In common:  `r length(common_proteins)`.

## BRCA1 burden for Kidney Cancer

```{r echo=FALSE, message=FALSE, warning=FALSE}
data <- as_tibble(read.table("../data/BRCA1_kidney.csv_2023_10_06_10_14_48.csv",
  header = TRUE, sep = ","
))

data <- data %>%
  mutate(Protein = str_extract(hgvsp, "(?<=:).+"))


common_proteins <- intersect(unique(data$Protein), unique(mave_data$Protein))
data_mave_df <- data %>% inner_join(mave_data, by = "Protein")

title_txt <- "Mave FUSE Score vs. Beta"
xlabel <- "FUSE Score"
ylabel <- "Beta"
x_col <- "FUSE_score"
y_col <- "beta"
xlimits <- c(-3, 4.5)
xbreaks <- seq(-3, 4.5, by = 1)
ylimits <- c(-1.5, 6)
ybreaks <- seq(-1.5, 6, by = 1)
pt <- get_scatter_plot(data_mave_df,
  title_txt,
  xlabel,
  ylabel,
  x_corr = 3,
  y_corr = 2.5,
  alpha = 2,
  raw_score,
  beta,
  point_size = 2,
  point_color = "#00AFBB",
  font_size = 14,
  annotate_text_size = 4,
  xlimits = xlimits,
  xbreaks = xbreaks,
  ylimits = ylimits,
  ybreaks = ybreaks
)
ggplotly(pt)
```


Total proteins In common:  `r length(common_proteins)`.
